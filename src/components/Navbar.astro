---
import LanguagePicker from '@/components/LanguagePicker.astro'
import { getRelativeLocaleUrl } from 'astro:i18n';
import { defaultLocale, useTranslations,prefixDefaultLocale,  type LanguageKey } from '@/i18n/i18n.ts';

const t = useTranslations(Astro.currentLocale as LanguageKey);

const links = [
  { url: '/', name: t('Navbar-1') },
  { url: '/about', name: t('Navbar-2') },
  { url: '/work', name: t('Navbar-3') },
];

function removeSlash(path: string) {
  return path.replace(/\//g, '');
}

function isActiveNavItem(navItem: string) {
  const { pathname } = new URL(Astro.request.url);
  const currentPath = pathname.replace(/^\/|\/$/g, '');
  const localePrefix = prefixDefaultLocale ? Astro.currentLocale : '';
  const isHomepage = navItem === '/'
  const isDefaultLocaleActive = currentPath === localePrefix
  const isOtherLocaleActive = currentPath === Astro.currentLocale

  if (isHomepage) {
    return isOtherLocaleActive || isDefaultLocaleActive;
  }

  return currentPath.includes(navItem.replace(/^\/|\/$/g, ''));
}
---

<nav style="height: var(--navbar-height)" class="px-4 flex flex-col md:flex-row flex-wrap justify-center  md:justify-between items-center container mx-auto">
  <a
    class="hover:bg-primary-100 p-4 -m-4 rounded-full aspect-square flex justify-center items-center transition-colors"
    href={getRelativeLocaleUrl(Astro.currentLocale || defaultLocale, '/')}
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      xml:space="preserve"
      x="0"
      y="0"
      style="enable-background:new 0 0 66 30"
      version="1.1"
      width="66"
      height="30"
      viewBox="0 0 66 30"
      ><style>
        .st0 {
          fill: currentColor;
        }
      </style>
      <title>Wei Logo</title>
      <path
        d="M3.8 15.2c-1.5 3-3.1 6.3-3.5 9.7-.2 1.8.2 3.8 2 4.5 1.7.7 3.6-.2 5.1-1.1 2.2-1.4 4.2-3.3 5.9-5.3 2.5-3 4.6-6.3 6.2-9.8-1-.4-1.9-.8-2.9-1.2-.9 3.3-1.9 7-1.7 10.5.1 1.9.7 4 2.8 4.6 1.8.5 3.6-.5 5-1.6 2.1-1.6 3.9-3.7 5.5-5.9 2.1-3 3.9-6.2 5.3-9.6.3-.8-.4-1.7-1.1-1.9-.9-.3-1.6.3-1.9 1.1-1.9 4.6-4.6 9.2-8.3 12.7-1.1 1-2.2 2-3.4 2.2.5-.1 0 0-.1 0 .2.1.2.1 0 0-.1-.1.2.2-.1 0l-.1-.1c.2.3-.2-.4-.1-.2-.1-.3-.2-.8-.2-.9-.4-3.3.7-6.8 1.6-9.9.5-1.7-2.1-2.9-2.9-1.2-2.2 4.8-5.3 9.5-9.4 12.9-.7.5-1.4 1-2.1 1.4-.4.2-.5.3-.8.4-.2.1-1 .2-.6.2h-.4s.2.1 0 0c.2.2.1.1 0 0 0 .1.1.2.2.2-.1 0-.2-.4-.1-.2s-.1-.2-.1-.3v-.7c.1-2.9 1.8-6.1 3.1-8.7.8-2-2-3.6-2.9-1.8zM36.1 19.6c2.6-1.4 5.3-2.9 7.3-5.1 1.1-1.1 2.3-2.8 1.9-4.4-.8-3.4-5.2-2.3-7.3-1-1.8 1.1-3.3 2.8-4.4 4.6-1.4 2.4-2.9 5.8-2.3 8.6.5 2.5 2.7 3.9 5.1 3.6 2.3-.2 4.5-1.5 6.4-2.8 4.8-3.3 9.4-7.8 12.6-12.8 1-1.5-1.3-3.3-2.5-1.9-1.9 2.4-4.1 5.1-4.8 8.2-.4 1.8-.2 3.9 1.6 4.9 1.9 1 4.3.3 6.2-.4 3.5-1.5 6.6-3.8 9.5-6.2 1.6-1.3-.7-3.5-2.2-2.2-2.3 2-4.8 3.8-7.6 5.1-.9.4-1.7.8-2.7 1-.6.1-1.3.2-1.6 0-.2-.1-.1-.1-.2-.1.2.1 0 .2 0 0 0-.1.1.2 0-.1-.1-.3 0 0 0-.2V18c0-.2.1-.6.2-.9.7-2.4 2.4-4.5 3.9-6.4-.8-.6-1.7-1.3-2.5-1.9-2.3 3.5-5.4 6.6-8.5 9.3-1.6 1.4-3.3 2.7-5.2 3.7-1.2.6-2.8 1.3-3.7.9-.1-.1-.3-.1-.4-.2-.5-.5-.5-1.2-.5-1.8.1-1.2.6-2.5 1.1-3.6.7-1.6 1.6-3.1 2.9-4.3.9-.9 1.9-1.4 2.9-1.7.1 0 .3-.1.4-.1-.4.1 0 0 .1 0h.6c-.7-.1.7.2-.1 0 0 0 .5.2 0-.1.2.1.1 0 0-.1.1.1 0-.1 0-.1 0 .1 0 .4 0 0 0 .1 0 .2-.1.3-.2.4.2-.3 0 .1-.1.2-.2.3-.3.5-.2.3-.3.4-.5.7-1.9 2-4.4 3.4-6.8 4.7-1.9.8-.3 3.5 1.5 2.6zM58.1 2.7c-.1-.1-.2-.1-.2-.2-.2-.1-.4-.2-.6-.2h-.6c-.2 0-.4.1-.5.3-.2.1-.3.3-.4.4-.1.1-.1.3-.2.4-.1.3-.1.6 0 .8.1.1.1.3.2.4.1.2.3.4.6.6.1.1.2.1.2.2.2.1.4.2.6.2h.6c.2 0 .4-.1.5-.3.2-.1.3-.3.4-.4.1-.1.1-.3.2-.4.1-.3.1-.6 0-.8-.1-.1-.1-.3-.2-.4-.1-.3-.3-.4-.6-.6z"
        class="st0"></path></svg
    >
  </a>

  <div class="flex gap-2 items-center">
    <ul class="flex gap-2">
      {
        links.map(({ url, name }) => (
          <li>
            <a
              class={`md:px-8 px-4 py-4 rounded-full transition-colors whitespace-nowrap ${
                isActiveNavItem(url) ? 'bg-primary-900 text-primary-50' : 'hover:bg-primary-100'
              }`}
              href={getRelativeLocaleUrl(Astro.currentLocale || defaultLocale, url)}
            >
              {name}
            </a>
          </li>
        ))
      }
    </ul>
    <LanguagePicker/>
  </div>

</nav>

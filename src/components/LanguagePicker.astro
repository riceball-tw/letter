---
import { languages, useTranslations, changeLanguage, type LanguageKey } from '@/i18n/i18n.ts';

const t = useTranslations(Astro.currentLocale as LanguageKey);
---
<button class="hover:bg-primary-100 p-4 rounded-full" popovertarget="i18n-menu" type="button">
  <!-- i18n icon -->
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M17.9 17.39c-.26-.8-1.01-1.39-1.9-1.39h-1v-3a1 1 0 0 0-1-1H8v-2h2a1 1 0 0 0 1-1V7h2a2 2 0 0 0 2-2v-.41a7.984 7.984 0 0 1 2.9 12.8M11 19.93c-3.95-.49-7-3.85-7-7.93c0-.62.08-1.22.21-1.79L9 15v1a2 2 0 0 0 2 2m1-16A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg>
</button>
<div class="bg-transparent text-center" id="i18n-menu" popover >
  <p class="text-xl mb-8 text-white font-bold">{t('LanguagePicker-1')}</p>
  <nav class="bg-white overflow-hidden shadow-lg rounded-full py-8 md:py-0">
    <ul class="flex flex-col md:flex-row gap-2 p-1">
      <!-- TypeScript: Object.keys return string[] -->
       <!-- https://stackoverflow.com/questions/52856496/typescript-object-keys-return-string -->
      {Object.entries(languages).map(([key, name]) => {
        const isCurrentLocale = Astro.currentLocale === key
        const activeStyle = 'bg-primary-900 text-primary-50 hover:bg-primary-900'
        const linkStyle = 'rounded-full transition-colors hover:bg-primary-100 text-xl p-8 inline-block'
        const stateStyle = isCurrentLocale ? activeStyle : ''

        return (
        <li>
          {isCurrentLocale ? <span class={`${linkStyle} ${stateStyle}`}>{name}</span> : <a class={`${linkStyle} ${stateStyle}`} href={changeLanguage(key as LanguageKey, Astro.url.pathname)}>{name}</a>
          }
        </li>
      )
      })}
    </ul>
  </nav>
</div>

<style>

  [popover]::backdrop {
    background-color: rgba(0, 0, 0, 0.4);
  }

  [popover]:popover-open {
    animation: fadein 0.5s;
    transition: overlay-behavior 0.5s;
    opacity: 1; /* UA default */
  }
  @keyframes fadein {
    from {
      opacity: 0;
    }
  }
  [popover]:closed {
    animation: fadeout 0.5s;
  }
  @keyframes fadeout {
    from {
      display: block;
    }
    to {
      opacity: 0;
    }
  }
</style>